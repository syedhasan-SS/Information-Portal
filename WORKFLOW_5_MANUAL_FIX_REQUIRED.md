# ‚ö†Ô∏è Workflow 5 Manual Fix Required

## üéØ Problem

Workflow 5 (Get Vendor GMV) returns 404 error:
```
"The requested webhook \"GET f404cc2c-e155-4a30-b531-72e32b99abc0/api/vendor/creed-vintage/gmv\" is not registered."
```

## üîç Root Cause

When the SQL query was updated via MCP (Model Context Protocol), the webhook node **lost its `webhookId` property**.

### How n8n Webhooks Work:
- Webhook nodes need a `webhookId` property (UUID generated by n8n)
- The production URL format is: `https://n8n.joinfleek.com/webhook/{webhookId}/{path}`
- When a workflow is activated, n8n registers the webhook using this webhookId
- **MCP cannot set or restore the webhookId property** - it's generated internally by n8n

### Comparison:

**Workflow 3 (Working):**
```json
{
  "parameters": {
    "path": "api/orders/vendor/:vendorHandle"
  },
  "webhookId": "f1b5e55c-a749-48bb-82e7-b9f34fac1eef"  // ‚úÖ Has webhookId
}
```
**Full URL:** `https://n8n.joinfleek.com/webhook/f1b5e55c-a749-48bb-82e7-b9f34fac1eef/api/orders/vendor/:vendorHandle`

**Workflow 5 (Broken):**
```json
{
  "parameters": {
    "path": "api/vendor/:vendorHandle/gmv"
  }
  // ‚ùå Missing webhookId property
}
```
**Expected URL:** `https://n8n.joinfleek.com/webhook/f404cc2c-e155-4a30-b531-72e32b99abc0/api/vendor/:vendorHandle/gmv`
**Problem:** No webhookId to register!

---

## ‚úÖ Solution: Manual Fix in n8n UI

You must manually fix this in the n8n web interface:

### Option 1: Recreate the Webhook Node (Recommended)

1. **Go to n8n**: https://n8n.joinfleek.com
2. **Open Workflow 5**: "5. Get Vendor GMV"
3. **Delete the webhook node**: Click on "Webhook - Get Vendor GMV" and delete it
4. **Add a new Webhook node**:
   - Drag "Webhook" from the node panel
   - Set **Path**: `api/vendor/:vendorHandle/gmv`
   - Set **HTTP Method**: GET
   - Set **Response Mode**: "Respond to Webhook"
5. **Connect the nodes**: Webhook ‚Üí BigQuery API ‚Üí Respond to Webhook
6. **Save the workflow**
7. **Activate the workflow** (toggle in top right)
8. **Copy the production webhook URL** from the webhook node
9. **Test the new URL**

### Option 2: Try to Regenerate webhookId

1. **Go to n8n**: https://n8n.joinfleek.com
2. **Open Workflow 5**: "5. Get Vendor GMV"
3. **Click on the webhook node**
4. **Deactivate the workflow** (toggle off)
5. **Make a small change** to the webhook node (e.g., add a space to the path and remove it)
6. **Save the workflow**
7. **Activate the workflow** (toggle on)
8. Check if webhookId was regenerated

---

## üìã Current State

### SQL Query: ‚úÖ CORRECT
The BigQuery query in Workflow 5 is correct:
```sql
SELECT vendor as vendor_handle,
       SUM(pre_discounted_gmv) as total_gmv,
       COUNT(DISTINCT order_id) as total_orders,
       MIN(order_created_date) as first_order_date,
       MAX(order_created_date) as last_order_date
FROM `dogwood-baton-345622.fleek_raw.order_line_finance_details`
WHERE vendor = '{{ $json.params["vendorHandle"] }}'
  AND ol_financial_status = 'Paid'
GROUP BY vendor
```

### Webhook Registration: ‚ùå BROKEN
The webhook node is missing its webhookId, so n8n cannot register it.

---

## üß™ After Manual Fix

Once you've recreated the webhook node, test with:

```bash
# The URL should be something like:
curl "https://n8n.joinfleek.com/webhook/{NEW_WEBHOOK_ID}/api/vendor/creed-vintage/gmv"

# Expected response:
# [{"f":[{"v":"creed-vintage"},{"v":"2029203.16"},{"v":"6127"},{"v":"2024-01-02T14:52:13Z"},{"v":"2026-02-10T06:29:21Z"}]}]
```

**Expected Results:**
- Vendor: creed-vintage
- Total GMV: ¬£2,029,203.16
- Total Orders: 6,127

---

## üìù Why MCP Can't Fix This

The n8n MCP tool can:
- ‚úÖ Update node parameters (like SQL queries)
- ‚úÖ Add/remove nodes
- ‚úÖ Connect nodes
- ‚úÖ Activate/deactivate workflows

But it **cannot**:
- ‚ùå Generate or set `webhookId` (internal to n8n)
- ‚ùå Register webhooks with n8n's webhook system
- ‚ùå Access n8n's internal webhook registry

The `webhookId` is generated by n8n when you:
1. Create a webhook node in the UI, OR
2. Import a workflow with an existing webhookId

When we updated the SQL query via MCP, it modified the workflow JSON but couldn't preserve the webhookId that was originally assigned when you created the workflow in the UI.

---

## üéØ Summary

**What works:**
- ‚úÖ SQL query is correct (uses right table and column)
- ‚úÖ Workflow is active
- ‚úÖ BigQuery credentials are configured
- ‚úÖ Node connections are correct

**What's broken:**
- ‚ùå Webhook node is missing webhookId
- ‚ùå Webhook not registered in n8n
- ‚ùå Returns 404 when called

**What you need to do:**
- üîß Manually recreate the webhook node in n8n UI
- üîß This will generate a new webhookId
- üîß Copy the new production webhook URL
- üîß Test with the new URL

---

## üöÄ Quick Steps

1. Login to n8n
2. Open Workflow 5
3. Delete and recreate webhook node
4. Set path: `api/vendor/:vendorHandle/gmv`
5. Connect nodes: Webhook ‚Üí BigQuery ‚Üí Respond
6. Save and activate
7. Copy new webhook URL
8. Test!

**Estimated time:** 3 minutes

---

**Created:** February 11, 2026
**Issue:** Webhook node missing webhookId after MCP update
**Solution:** Manual recreation of webhook node in n8n UI
